<!DOCTYPE html><!--Mobile_v7.0-->
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=2.0, minimum-scale=0.5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Soundins - Dither & NS Benchmarker (Mobile)</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background-color: #f0f0f0; color: #333; }
    #header-container { position: relative; text-align: center; padding: 10px 0; background-color: #0078d4; }
    #header-background { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('background.png') no-repeat center; background-size: cover; opacity: 0.1; z-index: 0; }
    #logo { width: 50px; height: auto; position: absolute; top: 10px; left: 10px; z-index: 2; }
    h1 { margin: 0; font-size: 18px; color: white; position: relative; z-index: 2; }
    #version-text { position: absolute; top: 10px; right: 10px; color: white; font-size: 12px; z-index: 2; }
    #fullscreen-btn { position: absolute; top: 10px; right: 40px; background: none; border: none; font-size: 20px; color: white; cursor: pointer; z-index: 2; }
    #readme-link { position: absolute; top: 10px; left: 70px; color: white; font-size: 12px; cursor: pointer; z-index: 2; }
    #language-menu { display: none; position: absolute; top: 30px; left: 70px; background: white; border: 1px solid #ccc; z-index: 3; }
    #language-menu button { display: block; width: 100%; padding: 5px; border: none; background: white; cursor: pointer; }
    #language-menu button:hover { background: #f0f0f0; }
    #mode-toggle-container { position: absolute; bottom: 10px; right: 10px; z-index: 2; }
    #mode-toggle-btn { background: none; border: none; cursor: pointer; padding: 0; }
    #mode-icon { width: 24px; height: 24px; }
    #rotation-message { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); color: white; justify-content: center; align-items: center; z-index: 1000; }
    #rotation-text { text-align: center; font-size: 20px; }
    #main-content { display: none; padding: 10px; }
    #progress-container { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; background: white; padding: 20px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 100; }
    #progress-bar { width: 100%; height: 20px; background: #ddd; border-radius: 10px; overflow: hidden; }
    #progress-fill { width: 0; height: 100%; background: #0078d4; transition: width 0.3s; }
    #progress-text { text-align: center; margin-top: 10px; }
    #main-row { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; margin: 10px 0; }
    .source-group { display: flex; flex-direction: column; align-items: center; margin-right: 10px; }
    .source-label { font-size: 14px; margin-bottom: 5px; }
    .source-btn { width: 80px; height: 30px; margin: 2px; background: #ccc; border: 1px solid #999; cursor: pointer; text-align: center; line-height: 30px; font-size: 12px; }
    .source-btn.active { background: #0078d4; color: white; }
    .rect { width: 80px; height: 60px; margin: 5px; background: #ddd; border: 1px solid #999; cursor: pointer; text-align: center; font-size: 12px; display: flex; align-items: center; justify-content: center; }
    .rect.green { background: #00cc00; color: white; }
    #toggle-btn { width: 60px; height: 60px; margin: 5px; background: url('play.png') no-repeat center; background-size: 40%; border: 1px solid #999; cursor: pointer; }
    #stop-btn { width: 60px; height: 60px; margin: 5px; background: url('stop.png') no-repeat center; background-size: 40%; border: 1px solid #999; cursor: pointer; }
    #table-container { overflow-x: auto; margin: 10px 0; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #999; padding: 5px; text-align: center; font-size: 12px; }
    th { background: #0078d4; color: white; }
    #spectrum-container { width: 100%; background: #fff; border: 1px solid #999; margin-top: 10px; }
    #spectrum-header { display: flex; justify-content: space-between; align-items: center; padding: 5px; background: #0078d4; color: white; }
    #spectrum-title { font-size: 14px; }
    #spectrum-buttons { display: flex; }
    #minimize-btn { width: 20px; height: 20px; background: url('minimize.png') no-repeat center; background-size: 60%; border: none; cursor: pointer; }
    #maximize-btn { width: 20px; height: 20px; background: url('maximize.png') no-repeat center; background-size: 60%; border: none; cursor: pointer; }
    #spectrumCanvas { width: 100%; height: 80px; display: block; }
    @media (orientation: portrait) { #rotation-message { display: flex; } #main-content { display: none; } }
    @media (orientation: landscape) { #rotation-message { display: none; } #main-content { display: block; } }
  </style>
</head>
<body>
  <div id="header-container">
    <div id="header-background"></div>
    <button id="fullscreen-btn" title="Maximizar pantalla">⛶</button>
    <span id="readme-link" onclick="toggleLanguageMenu()">Readme</span>
    <div id="language-menu">
      <button onclick="openInstructions('en')">English</button>
      <button onclick="openInstructions('es')">Español</button>
    </div>
    <a href="http://www.soundins.com.ar">
      <img src="Soundins.png" id="logo" alt="Logo de Soundins">
    </a>
    <h1>Dither & NS Benchmark Tool</h1>
    <div id="version-text">v7.0Mobile</div>
    <div id="mode-toggle-container">
      <button id="mode-toggle-btn">
        <img id="mode-icon" src="dark_mode.png" alt="Dark Mode">
      </button>
    </div>
  </div>
  <div id="rotation-message">
    <div id="rotation-text">Por favor, rote el dispositivo a la posición horizontal<br><br>Please rotate the device to horizontal position</div>
  </div>
  <div id="main-content">
    <div id="progress-container">
      <div id="progress-bar">
        <div id="progress-fill"></div>
      </div>
      <div id="progress-text">Loading Audio Files</div>
    </div>
    <div id="main-row">
      <div class="source-group">
        <span class="source-label">Source</span>
        <div class="source-btn active" id="source-Sine">Sine</div>
        <div class="source-btn" id="source-flaute">Instrument</div>
      </div>
      <div class="rect" id="rect-24bits">24 bits</div>
      <div class="rect" id="rect-main">16 bits No Dither</div>
      <button id="toggle-btn">997Hz</button>
      <button id="stop-btn"></button>
    </div>
    <div id="table-container">
      <table>
        <thead>
          <tr>
            <th>Izotope</th>
            <th>Izotope</th>
            <th>FabFilter</th>
            <th>Waves</th>
            <th>Waves</th>
            <th>Reaper</th>
            <th>Ableton</th>
            <th>Avid</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><div class="rect" id="rect-1">Ozone 11<br>Dither: Low<br>NS: Off</div></td>
            <td><div class="rect" id="rect-2">Ozone 11<br>Dither: Strong<br>NS: Off</div></td>
            <td><div class="rect" id="rect-3">Pro L2<br>Dither: On<br>NS: Off</div></td>
            <td><div class="rect" id="rect-4">L2<br>Dither: T1<br>NS: Off</div></td>
            <td><div class="rect" id="rect-5">L2<br>Dither: T2<br>NS: Off</div></td>
            <td><div class="rect" id="rect-8">Reaper<br>Dither: On<br>NS: Off</div></td>
            <td><div class="rect" id="rect-9">Live<br>Dither: TPDF<br>NS: Off</div></td>
            <td><div class="rect" id="rect-10">ProTools (Maxim)<br>Dither: On<br>NS: Off</div></td>
          </tr>
          <tr>
            <td><div class="rect" id="rect-31">Ozone 11<br>Dither: Low<br>NS: Max</div></td>
            <td><div class="rect" id="rect-32">Ozone 11<br>Dither: Strong<br>NS: Max</div></td>
            <td><div class="rect" id="rect-33">Pro L2<br>Dither: On<br>NS: Weighted</div></td>
            <td><div class="rect" id="rect-34">L2<br>Dither: T1<br>NS: Ultra</div></td>
            <td><div class="rect" id="rect-35">L2<br>Dither: T2<br>NS: Ultra</div></td>
            <td><div class="rect" id="rect-38">Reaper<br>Dither: On<br>NS: On</div></td>
            <td><div class="rect" id="rect-39">Live<br>Dither: TPDF<br>NS: POWr3</div></td>
            <td><div class="rect" id="rect-40">ProTools (Dither)<br>Dither: On<br>NS: Type 3</div></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div id="spectrum-container" class="minimized">
      <div id="spectrum-header">
        <span id="spectrum-title">Spectrum Analyzer</span>
        <div id="spectrum-buttons">
          <button id="minimize-btn"></button>
          <button id="maximize-btn"></button>
        </div>
      </div>
      <canvas id="spectrumCanvas"></canvas>
    </div>
  </div>

  <script>
    const audioMapping = {
      "rect-24bits": { "Sine": { "NA": "sine_24bits.flac" }, "flaute": { "NA": "flaute_24bits.flac" } },
      "rect-main": { "Sine": { "997(act)": "sine_16bits_no_dither_997hz.flac", "997(no)": "sine_16bits_no_dither.flac" }, "flaute": { "NA": "flaute_16bits_no_dither.flac" } },
      "rect-1": { "Sine": { "997(act)": "sine_ozone11_low_off_997hz.flac", "997(no)": "sine_ozone11_low_off.flac" }, "flaute": { "NA": "flaute_ozone11_low_off.flac" } },
      "rect-2": { "Sine": { "997(act)": "sine_ozone11_strong_off_997hz.flac", "997(no)": "sine_ozone11_strong_off.flac" }, "flaute": { "NA": "flaute_ozone11_strong_off.flac" } },
      "rect-3": { "Sine": { "997(act)": "sine_prol2_on_off_997hz.flac", "997(no)": "sine_prol2_on_off.flac" }, "flaute": { "NA": "flaute_prol2_on_off.flac" } },
      "rect-4": { "Sine": { "997(act)": "sine_l2_t1_off_997hz.flac", "997(no)": "sine_l2_t1_off.flac" }, "flaute": { "NA": "flaute_l2_t1_off.flac" } },
      "rect-5": { "Sine": { "997(act)": "sine_l2_t2_off_997hz.flac", "997(no)": "sine_l2_t2_off.flac" }, "flaute": { "NA": "flaute_l2_t2_off.flac" } },
      "rect-8": { "Sine": { "997(act)": "sine_reaper_on_off_997hz.flac", "997(no)": "sine_reaper_on_off.flac" }, "flaute": { "NA": "flaute_reaper_on_off.flac" } },
      "rect-9": { "Sine": { "997(act)": "sine_live_tpdf_off_997hz.flac", "997(no)": "sine_live_tpdf_off.flac" }, "flaute": { "NA": "flaute_live_tpdf_off.flac" } },
      "rect-10": { "Sine": { "997(act)": "sine_protools_maxim_on_off_997hz.flac", "997(no)": "sine_protools_maxim_on_off.flac" }, "flaute": { "NA": "flaute_protools_maxim_on_off.flac" } },
      "rect-31": { "Sine": { "997(act)": "sine_ozone11_low_max_997hz.flac", "997(no)": "sine_ozone11_low_max.flac" }, "flaute": { "NA": "flaute_ozone11_low_max.flac" } },
      "rect-32": { "Sine": { "997(act)": "sine_ozone11_strong_max_997hz.flac", "997(no)": "sine_ozone11_strong_max.flac" }, "flaute": { "NA": "flaute_ozone11_strong_max.flac" } },
      "rect-33": { "Sine": { "997(act)": "sine_prol2_on_weighted_997hz.flac", "997(no)": "sine_prol2_on_weighted.flac" }, "flaute": { "NA": "flaute_prol2_on_weighted.flac" } },
      "rect-34": { "Sine": { "997(act)": "sine_l2_t1_ultra_997hz.flac", "997(no)": "sine_l2_t1_ultra.flac" }, "flaute": { "NA": "flaute_l2_t1_ultra.flac" } },
      "rect-35": { "Sine": { "997(act)": "sine_l2_t2_ultra_997hz.flac", "997(no)": "sine_l2_t2_ultra.flac" }, "flaute": { "NA": "flaute_l2_t2_ultra.flac" } },
      "rect-38": { "Sine": { "997(act)": "sine_reaper_on_on_997hz.flac", "997(no)": "sine_reaper_on_on.flac" }, "flaute": { "NA": "flaute_reaper_on_on.flac" } },
      "rect-39": { "Sine": { "997(act)": "sine_live_tpdf_powr3_997hz.flac", "997(no)": "sine_live_tpdf_powr3.flac" }, "flaute": { "NA": "flaute_live_tpdf_powr3.flac" } },
      "rect-40": { "Sine": { "997(act)": "sine_protools_dither_on_type3_997hz.flac", "997(no)": "sine_protools_dither_on_type3.flac" }, "flaute": { "NA": "flaute_protools_dither_on_type3.flac" } }
    };

    let isToggleEnabled = true;
    let currentActiveRect = null;
    let currentSource = "Sine";
    const audioPlayers = {};
    let preloadPromise = null;
    let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

    const sourceSine = document.getElementById("source-Sine");
    const sourceFlaute = document.getElementById("source-flaute");
    const toggleBtn = document.getElementById("toggle-btn");
    const stopBtn = document.getElementById("stop-btn");
    const progressContainer = document.getElementById("progress-container");
    const progressFill = document.getElementById("progress-fill");

    const rectsToLoad = [
      "rect-24bits", "rect-main",
      "rect-1", "rect-2", "rect-3", "rect-4", "rect-5", "rect-8", "rect-9", "rect-10",
      "rect-31", "rect-32", "rect-33", "rect-34", "rect-35", "rect-38", "rect-39", "rect-40"
    ];

    let audioContext = null;
    let analyser = null;
    let sourceNode = null;
    let gainNode = null;
    let mediaSource = null;
    const canvas = document.getElementById("spectrumCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 250;
    canvas.height = 80;
    let smoothedData = null;
    const smoothingWindow = 50;
    let dataHistory = [];

    function initializeAudioContext() {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 16384;
      analyser.smoothingTimeConstant = 0.1;
      analyser.minDecibels = -110;
      analyser.maxDecibels = -60;
      gainNode = audioContext.createGain();
      gainNode.gain.setValueAtTime(isIOS ? 2.0 : 1.0, audioContext.currentTime);
      smoothedData = new Float32Array(analyser.frequencyBinCount);
      resumeAudioContext();
      if (!window.isDrawing) {
        window.isDrawing = true;
        drawSpectrum();
      }
    }

    async function resumeAudioContext() {
      if (audioContext && audioContext.state === "suspended") {
        await audioContext.resume();
      }
    }

    function drawSpectrum() {
      if (!analyser) return;

      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      analyser.getByteFrequencyData(dataArray);

      dataHistory.push(new Uint8Array(dataArray));
      if (dataHistory.length > smoothingWindow) dataHistory.shift();

      for (let i = 0; i < bufferLength; i++) {
        let sum = 0;
        for (let j = 0; j < dataHistory.length; j++) {
          sum += dataHistory[j][i];
        }
        smoothedData[i] = sum / dataHistory.length;
      }

      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      if (sourceNode || mediaSource) {
        ctx.lineWidth = 2;
        ctx.strokeStyle = "rgb(0, 255, 0)";
        ctx.beginPath();

        const sampleRate = audioContext.sampleRate;
        const freqMax = sampleRate / 2;
        const freqStep = freqMax / bufferLength;

        const minFreq = 20;
        const maxFreq = 20000;
        const logMin = Math.log10(minFreq);
        const logMax = Math.log10(maxFreq);
        const logRange = logMax - logMin;

        ctx.moveTo(0, canvas.height);
        for (let i = 0; i < bufferLength; i++) {
          const freq = i * freqStep;
          if (freq < minFreq || freq > maxFreq) continue;

          const logFreq = Math.log10(freq);
          const x = canvas.width * (logFreq - logMin) / logRange;
          const value = smoothedData[i] / 255;
          const y = canvas.height * (1 - value);
          ctx.lineTo(x, y);
        }
        ctx.stroke();
      }

      requestAnimationFrame(drawSpectrum);
    }

    async function preloadAllAudio() {
      const totalFiles = Object.values(audioMapping).reduce((sum, sources) => sum + Object.values(sources).reduce((subSum, states) => subSum + Object.keys(states).length, 0), 0);
      let loadedFiles = 0;

      const loadPromises = [];
      for (const rectId in audioMapping) {
        audioPlayers[rectId] = {};
        for (const source in audioMapping[rectId]) {
          audioPlayers[rectId][source] = {};
          for (const state in audioMapping[rectId][source]) {
            const url = audioMapping[rectId][source][state];
            loadPromises.push(
              fetch(url)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                  audioPlayers[rectId][source][state] = { buffer: arrayBuffer };
                  loadedFiles++;
                  progressFill.style.width = `${(loadedFiles / totalFiles) * 100}%`;
                })
                .catch(error => {
                  console.error(`Error preloading ${url}:`, error);
                  loadedFiles++;
                  progressFill.style.width = `${(loadedFiles / totalFiles) * 100}%`;
                })
            );
          }
        }
      }

      await Promise.all(loadPromises);
      setTimeout(() => progressContainer.style.display = "none", 200);
    }

    async function playAudioFromMemory(audioData, rect) {
      if (isIOS) {
        const blob = new Blob([audioData], { type: "audio/flac" });
        const audioURL = URL.createObjectURL(blob);
        const iosAudio = document.getElementById("ios-audio");

        iosAudio.src = audioURL;
        iosAudio.load();

        if (audioContext && analyser) {
          mediaSource = audioContext.createMediaElementSource(iosAudio);
          mediaSource.connect(analyser);
          analyser.connect(audioContext.destination);
        }

        iosAudio.play().then(() => {
          rect.classList.add("green");
          iosAudio.onended = () => {
            rect.classList.remove("green");
            stopAudio();
          };
        }).catch(error => {
          console.error("iOS audio playback failed:", error);
          rect.classList.remove("green");
        });
        return;
      }

      if (!audioContext) initializeAudioContext();
      await resumeAudioContext();
      stopAudio();

      const audioBuffer = await audioContext.decodeAudioData(audioData.slice(0));
      sourceNode = audioContext.createBufferSource();
      sourceNode.buffer = audioBuffer;

      sourceNode.connect(analyser);
      analyser.connect(gainNode);
      gainNode.connect(audioContext.destination);

      sourceNode.start();
      rect.classList.add("green");
      sourceNode.onended = () => {
        rect.classList.remove("green");
        stopAudio();
      };
    }

    function stopAudio() {
      if (isIOS) {
        const iosAudio = document.getElementById("ios-audio");
        if (iosAudio) {
          iosAudio.pause();
          iosAudio.src = "";
        }
        if (mediaSource) {
          mediaSource.disconnect();
          mediaSource = null;
        }
      }
      if (sourceNode) {
        sourceNode.stop();
        sourceNode.disconnect();
        sourceNode = null;
      }
      if (analyser) analyser.disconnect();
      if (gainNode) gainNode.disconnect();
      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      dataHistory = [];
    }

    async function playAudio(rect) {
      if (!audioContext) initializeAudioContext();
      await resumeAudioContext();
      const rectId = rect.id;
      const state = rectId === "rect-24bits" && currentSource === "Sine" ? "NA" : (isToggleEnabled ? "997(act)" : "997(no)");
      const audioData = audioPlayers[rectId]?.[currentSource]?.[currentSource === "Sine" ? state : "NA"]?.buffer;
      if (audioData) {
        stopAudio();
        currentActiveRect = rect;
        await playAudioFromMemory(audioData, rect);
      }
    }

    sourceSine.addEventListener("click", () => {
      currentSource = "Sine";
      sourceSine.classList.add("active");
      sourceFlaute.classList.remove("active");
    });

    sourceFlaute.addEventListener("click", () => {
      currentSource = "flaute";
      sourceFlaute.classList.add("active");
      sourceSine.classList.remove("active");
    });

    toggleBtn.addEventListener("click", () => {
      isToggleEnabled = !isToggleEnabled;
      toggleBtn.textContent = isToggleEnabled ? "997Hz" : "No 997Hz";
    });

    stopBtn.addEventListener("click", () => {
      stopAudio();
      document.querySelectorAll(".rect.green").forEach(rect => rect.classList.remove("green"));
      currentActiveRect = null;
    });

    rectsToLoad.forEach(id => {
      const rect = document.getElementById(id);
      rect.addEventListener("click", () => playAudio(rect));
    });

    document.addEventListener('touchstart', () => {
      if (!audioContext) initializeAudioContext();
    }, { once: true });

    preloadPromise = preloadAllAudio();
  </script>

  <audio id="ios-audio" style="display: none;"></audio>
</body>
</html>